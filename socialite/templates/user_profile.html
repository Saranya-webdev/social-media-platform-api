<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ user_profile.user.username }}'s profile on our platform. Explore their posts and follow them.">
    <meta name="author" content="{{ user_profile.user.username }}">
    <title>{{ user_profile.user.username }}'s Profile</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <!-- Font Awesome CDN -->
</head>

<body>
    <div class="profile-container">
        <h1>{{ user_profile.user.username }}</h1>

        <!-- Profile Picture -->
        {% if user_profile.profile_picture %}
    <img src="{{ user_profile.profile_picture.url }}" alt="{{ user_profile.user.username }}'s Profile Picture" class="profile-image">
{% else %}
    <img src="{% static 'images/default.png' %}" alt="Default Profile Picture" class="profile-image">
{% endif %}

        <div class="profile-summary">
            <span>{{ post_count }} posts</span>
    <span><a href="{% url 'followers_list' user_profile.user.id %}">{{ followers_count }} followers</a></span>
    <span><a href="{% url 'following_list' user_profile.user.id %}">{{ following_count }} following</a></span>


        </div>

        <!-- Bio Section -->
        {% if user_profile.bio %}
            <p>{{ user_profile.bio }}</p>
        {% else %}
            <p>This user hasn't added a bio yet.</p>
        {% endif %}
        {% if user_profile.user != request.user %}
        {% if is_following %}
            <form action="{% url 'unfollow_user' user_id=user_profile.user.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Unfollow</button>
            </form>
        {% else %}
            <form action="{% url 'follow_user' user_id=user_profile.user.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-success">Follow</button>
            </form>
        {% endif %}
    {% endif %}

        {% if posts.exists %}
    <h3>Posts by {{ user_profile.user.username }}</h3>
    {% for post in posts %}
        <!-- Display Post Image -->
        {% if post.image %}
            <img src="{{ post.image.url }}" alt="Image for post titled {{ post.content|truncatewords:10 }}" class="post-thumbnail">
        {% else %}
            <img src="{% static 'images/default.png' %}" alt="Default Image" class="post-thumbnail">
        {% endif %}

        <!-- Post Content -->
        <p class="post-snippet">{{ post.content|truncatewords:30 }}...</p>

        <!-- Post Metadata -->
        <p class="post-meta">
            By <a href="{% url 'user_profile' post.author.id %}">{{ post.author.username }}</a> 
            on {{ post.created_at|date:"F j, Y" }}
        </p>

        <!-- Post Stats -->
        <div class="post-info">
            <a href="{% url 'post_detail' post.id %}">
                <i class="fa-regular fa-heart like-icon"></i> Likes ({{ post.likes.count }})
                
            </a> 
            <a href="{% url 'post_detail' post.id %}">
                <i class="fa-regular fa-comment comment-icon"></i> Comments ({{ post.comments.count }})
            </a>
        </div>
    {% endfor %}
{% else %}
    <p class="no-posts">No posts available.</p>
{% endif %}
    </div>
</body>

</html>
